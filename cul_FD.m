%G_task.mat是不同脑网络的time series数据，statelabel_m1andm2.mat是vpath数据，即状态属于M1或M2.
load('G_task.mat');
load('statelabel_m1andm2.mat');
columnValues = [18.8739726,	19.69315068,	20.15890411,	22.03013699,	23.4739726,	23.14794521,	19.26575342,	19.32054795,	22.47123288,	24.23287671,	22.06575342,	24.33424658,	23.55616438,	26.92054795,	22.79178082,	24.43287671,	23.62739726,	25.89863014,	24.85753425,	20.08493151,	21.55890411,	21.58082192,	21.4630137,	26.14520548,	27.72876712,	24.16986301,	24.89315068,	22.02465753,	25.17534247,	22.09041096,	23.31506849,	20.90958904,	25.09315068,	27.58630137,	20.15890411,	21.82465753,	24,	22.86849315,	19.99726027,	22.83013699,	22.3890411,	22.2109589,	20.60273973,	21.44931507,	21.66575342,	20.36164384,	20.08493151,	20.10136986,	20.74246575,	21.59178082,	27.7260274,	23.83835616,	19.42465753,	20.53972603,	19.63561644,	19.64109589,	21.82465753,	18.84931507,	20.44657534,	19.46575342,	17.98630137,	22.67671233,	20.93424658,	19.35890411,	23.84931507,	20.2,	20.30684932,	22.30410959,	25.39726027,	25.09315068,	20.5890411,	19.77260274,	19.75342466,	23.91232877,	22.38630137,	26.28767123,	20.69315068,	24.16986301,	22.91232877,	23.27945205,	20.73972603,	21.28219178,	20.89863014,	24.04657534,	22.01917808,	20.20273973,	22.15342466,	21.00273973,	18.84109589,	21.95068493,	21.97534247,	19.64657534,	23.55068493,	21.68493151,	23.13150685,	23.01643836,	25.6739726,	20.14246575,	28.84657534,	22.64931507,	22.05205479,	28.06849315,	19.4,	24.44383562,	22.90684932,	20.35890411,	21.60273973,	24.74520548,	25.3260274,	24.00821918,	22.29315068,	23.78630137,	22.86575342,	23.41369863,	27.23561644,	25.27123288,	21.66849315,	22.92054795,	19.80547945,	21.37534247,	20.14520548,	19.05753425,	18.10410959,	20.33150685,	19.73150685,	19.04931507,	24.72328767,	21.76164384,	25.06849315,	20.4630137,	18.84383562,	25.31506849,	24.29315068,	21.81643836,	23.5890411,	19.5260274,	20.16986301,	24.6109589,	23.81369863,	23.14246575,	23.04383562,	19.56712329,	21.03561644,	20.06027397,	22.53150685,	23.01643836,	19.80273973,	19.69589041,	24.4082191]; % 这里填入你的具体数据

numSubjects = 149;
numIterations = 100;

% 初始化数组以保存结果
discrepancy_coefficients = zeros(numSubjects, numIterations, 2);
r_values = zeros(numIterations, 2);
p_values = zeros(numIterations, 2);

% 主循环
for repeat = 1:numIterations
    for condition = 1:2
        for j = 1:numSubjects
            dataG = G_task((j - 1) * 756 + 1 : j * 756, :);
            dataV = V_taskonly12b((j - 1) * 756 + 1 : j * 756, :);

            % 获取条件的行索引
            stateIdx = dataV(:, 1) == condition;

            % 如果条件中有足够的数据
            if sum(stateIdx) >= 100
                % 随机抽取100个数据行
                dataSampled = datasample(dataG(stateIdx, :), 100, 'Replace', false);

                % 计算相关矩阵和离散系数
                correlationMatrix = corr(dataSampled);
                lowerTriangular = tril(correlationMatrix, -1);
                discrepancy_coefficients(j, repeat, condition) = std(lowerTriangular(lowerTriangular ~= 0));
            else
                discrepancy_coefficients(j, repeat, condition) = NaN;
            end
        end
    end

      selected_discrepancies = discrepancy_coefficients([1,	2,	3,	4,	5,	6,	7,	8,	9,	10,	11,	12,	13,	14,	15,	16,	17,	18,	19,	20,	21,	22,	23,	24,	25,	26,	27,	28,	29,	30,	31,	32,	33,	34,	35,	36,	37,	38,	39,	40,	41,	42,	43,	44,	45,	46,	47,	48,	49,	50,	51,	52,	53,	54,	55,	56,	57,	58,	59,	60,	61,	62,	63,	64,	65,	66,	67,	68,	69,	70,	71,	72,	73,	74,	75,	76,	77,	78,	79,	80,	81,	82,	83,	84,	85,	86,	87,	88,	89,	90,	91,	92,	93,	94,	95,	96,	97,	98,	99,	100,	101,	102,	103,	104,	105,	106,	107,	108,	109,	110,	111,	112,	113,	114,	115,	116,	117,	118,	119,	120,	121,	122,	123,	124,	125,	126,	127,	128,	129,	130,	131,	132,	133,	134,	135,	136,	137,	138,	139,	140,	141,	142,	143,	144,	145,	146,	147,	148,	149
], repeat, :);
    % 对A和B条件分别进行皮尔逊相关分析
    for condition = 1:2
        % 删除含有NaN的行
        validIdx = ~isnan(selected_discrepancies(:, condition));
        valid_discrepancies = selected_discrepancies(validIdx, condition);
        valid_columnValues = columnValues(validIdx);
        valid_columnValues = valid_columnValues';
        % 计算相关系数
        [r_values(repeat, condition), p_values(repeat, condition)] = corr(valid_discrepancies, valid_columnValues);
    end
end

% 保存结果
save('discrepancy_coefficients.mat', 'discrepancy_coefficients');
save('correlation_results.mat', 'r_values', 'p_values');
